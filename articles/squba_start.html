<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to squba • squba</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to squba">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">squba</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/squba_start.html">Getting Started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-modules" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Modules</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-modules">
<li><h6 class="dropdown-header" data-toc-skip>Cohort Identification</h6></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/cohortattrition">  Cohort Attrition</a></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/sensitivityselectioncriteria">  Sensitivity to Selection Criteria</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cohort Fitness</h6></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/patientfacts">  Patient Facts</a></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/patienteventsequencing">  Patient Event Sequencing</a></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/patientrecordconsistency">  Patient Record Consistency</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Variable Testing</h6></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/expectedvariablespresent">  Expected Variables Present</a></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/ssdqa/quantvariabledistribution">  Quantitative Variable Distribution</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/categoricalvariabledistribution">  Categorical Variable Distribution</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Concept Set Testing</h6></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/conceptsetdistribution/">  Concept Set Distribution</a></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/sourceconceptvocabularies">  Source &amp; Concept Vocabularies</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Dataset Fitness</h6></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/clinicalevents.specialties">  Clinical Events &amp; Specialties</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/database_connection.html">Database Connection</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://hdl.handle.net/20.500.14642/2">PEDSpace</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ssdqa/squba/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to squba</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ssdqa/squba/blob/main/vignettes/squba_start.Rmd" class="external-link"><code>vignettes/squba_start.Rmd</code></a></small>
      <div class="d-none name"><code>squba_start.Rmd</code></div>
    </div>

    
    
<p><code>squba</code> is a suite of data quality modules, built entirely
in R, that are designed to evaluate different data quality domains
throughout the process of an observational study. They are compatible
with both the OMOP and PCORnet Common Data Models (CDM) and can help
investigators to dive into anything from the patient retention in their
attrition, to the utility of their concept sets, to the fact density
within their study cohort.</p>
<p>Each module, among things specific to the execution of that
particular data quality probe, has certain inputs and parameters that
are standard across the entire suite. This guide will walk through what
each of these inputs are and what role they play in your data quality
analysis.</p>
<div class="section level2">
<h2 id="analysis-specific-inputs">Analysis-Specific Inputs<a class="anchor" aria-label="anchor" href="#analysis-specific-inputs"></a>
</h2>
<div class="section level3">
<h3 id="the-cohort">The Cohort<a class="anchor" aria-label="anchor" href="#the-cohort"></a>
</h3>
<p>Each module will require you to provide a table containing the
foundation of your study analysis: your cohort! This table must have, at
a minimum, the following four columns:</p>
<div class="section level4">
<h4 id="site">Site<a class="anchor" aria-label="anchor" href="#site"></a>
</h4>
<p>The <code>site</code> column is originally intended for network-level
analyses where data from multiple institutions is available. But really,
it’s just the primary grouping variable that will be used in the
multi-site analysis type. You can input the names of different data
sources so you can compare how patients at these institutions behave, or
you can input a different patient characteristic, like sex or a more
study-specific flag, to compare those groups to one another.</p>
</div>
<div class="section level4">
<h4 id="patient-identifier">Patient Identifier<a class="anchor" aria-label="anchor" href="#patient-identifier"></a>
</h4>
<p>This column will contain all of the unique patient identifiers used
to classify members of your cohort. If you are using the OMOP data
model, this will be the <code>person_id</code> column. If you are using
PCORnet, this will be the <code>patid</code> column.</p>
</div>
<div class="section level4">
<h4 id="start-date">Start Date<a class="anchor" aria-label="anchor" href="#start-date"></a>
</h4>
<p>The <code>start_date</code> column should indicate the earliest date
for which data can be extracted for that patient. This will most likely
be the cohort entry date.</p>
<p>Note that for longitudinal analyses, patients will only be included
in the time period of interest after their start date has passed. So if
a patient’s start date is 1/1/2010, they will not be treated as a member
of the cohort when looking at the year of 2009 or the month of December
2009, even if they have data available in that period. They will only be
treated as a full member of the cohort starting in the year of 2010 or
the month of January 2010.</p>
</div>
<div class="section level4">
<h4 id="end-date">End Date<a class="anchor" aria-label="anchor" href="#end-date"></a>
</h4>
<p>The <code>end_date</code> column should indicate the latest date for
which data can be extracted for that patient. This may be the end of the
follow-up period or the date of another event that indicates an exit
from the cohort.</p>
<p>Note that for longitudinal analyses, patients will only be included
in the time period of interest before their end date has passed. So if a
patient’s end date is 1/1/2020, they will not be treated as a member of
the cohort when looking at the year of 2021 or the month of February
2020, even if they have data available in that period. They will only be
treated as a full member of the cohort up to and including the year of
2020 or the month of January 2020.</p>
<hr>
<p>Providing all this information will give the module three essential
pieces of information:</p>
<ul>
<li>Which patients in your dataset should be included in the data
quality analysis</li>
<li>How many sites are present among these patients</li>
<li>What is the cohort period of interest for which data should be
extracted</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="the-definition-table">The Definition Table<a class="anchor" aria-label="anchor" href="#the-definition-table"></a>
</h3>
<p>Each module will ask that you provide a table that defines the
targets for your data quality analysis. While the specific contents of
this table differ between modules, generally it will ask you to provide
information about:</p>
<ul>
<li>the CDM table where the domain or variable is defined and any
additional filtering logic that should be applied to this table</li>
<li>the column containing concepts or codes that are used to define your
analysis target</li>
<li>the date column that should be used for any temporal filtering</li>
<li>the name of the concept set, found in a pre-defined directory, that
is used to define a variable</li>
</ul>
<p>For more details about what is required, please see the documentation
for the specific module you would like to use.</p>
</div>
<div class="section level3">
<h3 id="concept-sets">Concept Sets<a class="anchor" aria-label="anchor" href="#concept-sets"></a>
</h3>
<p><code>squba</code> modules expect concept sets, which contain sets of
codes to define a single clinical concept or variable, to be in a
specific format to ensure these files can be referenced in a standard
way across the suite. They must contain the following two columns:</p>
<ul>
<li>
<code>concept_id</code>, which contains the OMOP-specific reference
value for a given clinical code. For PCORnet implementations, this
column should still be included but can be left blank or filled with a
random integer.</li>
<li>
<code>concept_code</code>, which contains the actual clinical code,
like a LOINC or ICD10 code. For OMOP implementations, this column should
still be included but can be left blank or filled with a random
character.</li>
</ul>
<p>For PCORnet implementations, a <code>vocabulary_id</code> column may
also be required. For some domains in this data model, like in the
diagnosis table, there is a field that defines the ontology to which a
code belongs in order to help differentiate between similar vocabularies
(like ICD9 and ICD10). The <code>vocabulary_id</code> field should
contain the vocabulary identifier as it appears in the CDM, which will
then be included as a parameter in the join between the concept set and
the CDM.</p>
<p>Other information, such as a <code>concept_name</code> with the full
description of the concept, can be included in this file but is not
required.</p>
<div class="callout-tip">
<p>Any concept set used as input to <code>squba</code> should be stored
as a CSV file in a pre-defined file subdirectory in your project (see <a href="https://ssdqa.github.io/squba/articles/database_connection.html">Connecting
to your Data</a> for more details).</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="module-parameters">Module Parameters<a class="anchor" aria-label="anchor" href="#module-parameters"></a>
</h2>
<p>Most modules, with exceptions for modules like Cohort Attrition that
cannot be assessed longitudinally, will contain
<code>multi_or_single_site</code>, <code>anomaly_or_exploratory</code>,
and <code>time</code> as function parameters. The sections below will
explain what each of these parameters means and why you may want to
select one option versus the other.</p>
<div class="section level3">
<h3 id="single-versus-multi-site-analyses">Single versus Multi-Site Analyses<a class="anchor" aria-label="anchor" href="#single-versus-multi-site-analyses"></a>
</h3>
<p>This parameter essentially controls whether you want to utilize the
<code>site</code> column in your cohort table as a grouping variable.
But beyond that, it also will control whether you are comparing the
behavior of the targets of your analysis (variables, codes, etc.) versus
comparing the behavior of the different sites in your cohort. For
example, in the <a href="https://ssdqa.github.io/expectedvariablespresent/" class="external-link">Expected
Variables Present</a> module, toggling this parameter will control
whether you see a bar graph highlighting that your cohort has more
hypertension diagnoses than diabetes diagnoses or whether you see a heat
map demonstrating that one institution has more hypertension diagnoses
than another.</p>
<p>If you only have one site in your cohort file, only single site
analysis are possible so you can “set and forget” this parameter. If you
have multiple sites, however, both the single and multi-site analyses
are available to you. A single site analysis when multiple sites are
present in the cohort file will essentially ignore the <code>site</code>
column and treat the whole cohort as one big group. If you really only
want to target one site in isolation, you should be sure to filter your
cohort before executing the single site analysis.</p>
</div>
<div class="section level3">
<h3 id="exploratory-versus-anomaly-detection-analyses">Exploratory versus Anomaly Detection Analyses<a class="anchor" aria-label="anchor" href="#exploratory-versus-anomaly-detection-analyses"></a>
</h3>
<p>This parameter controls the type of computation that will be executed
for the analysis. Exploratory checks extract high level summary
information, like counts and proportions, and make them available to you
so you can get a general picture of what the data looks like. Anomaly
detection checks will take this information and execute a more formal
statistical computation to identify outliers within the result set. In
the <a href="https://ssdqa.github.io/conceptsetdistribution/" class="external-link">Concept
Set Distribution</a> module, an exploratory analysis may demonstrate
that a few codes stand out as the most frequently used when defining a
variable, but an anomaly detection analysis may reveal that only one of
them is anomalous compared to the rest of the codes in the concept
set.</p>
<p>The Single Site, Anomaly Detection, Cross-Sectional checks tend to
apply different methods of identifying anomalies across all the modules.
However, most of the other anomaly detection methods, described in the
table below, are very similar across the suite.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="11%">
<col width="60%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>Method</th>
<th>Package Dependencies</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Single Site, Anomaly Detection, Longitudinal</td>
<td>For yearly time periods, this check will employ a control chart
method to identify anomalies across the time series. For any time period
smaller than a year, a more sensitive STL regression method that handles
things like seasonality is applied instead.</td>
<td>
<p><a href="https://anhoej.github.io/qicharts2/" class="external-link">qicharts2</a>
(control chart)</p>
<p><a href="https://business-science.github.io/timetk/articles/TK08_Automatic_Anomaly_Detection.html" class="external-link">timetk</a>
(STL regression)</p>
</td>
</tr>
<tr class="even">
<td>Multi-Site, Anomaly Detection, Cross-Sectional</td>
<td>
<p>This check uses the outlier detection method from the hotspots
package, which uses a robust root mean square approach and a
(user-defined) p-value to identify anomalous values.</p>
<p>Note that analysis target groups are only eligible for anomaly
detection analysis if the meet the following criteria:</p>
<ol style="list-style-type: decimal">
<li>Mean &gt; 0.02, OR</li>
<li>Median &gt; 0.01, OR</li>
<li>(Mean &gt; 0.05 &amp; range &gt; 0.01), OR</li>
<li>Coefficient of variance &gt; 0.1 &amp; sample size &gt; 11</li>
</ol>
</td>
<td><a href="https://cran.r-project.org/web/packages/hotspots/index.html" class="external-link">hotspots</a></td>
</tr>
<tr class="odd">
<td>Multi-Site, Anomaly Detection, Longitudinal</td>
<td>This check will use a Euclidean distance method to evaluate the
average distance between the overall, all-site time series and the
site-specific time series for the analysis target, with Loess smoothing
applied to each time series.</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="cross-sectional-versus-longitudinal-analyses">Cross-Sectional versus Longitudinal Analyses<a class="anchor" aria-label="anchor" href="#cross-sectional-versus-longitudinal-analyses"></a>
</h3>
<p>This parameter controls whether you look at a static snapshot of the
data versus a longitudinal time series. It can be beneficial to look at
certain things across time to identify any temporal trends in how the
data behaves. These could be expected, like seeing impacts of the switch
from ICD9 to ICD10, or unexpected, like seeing a sudden spike in the
prescription of a drug from one year to the next.</p>
<p>In the <a href="https://ssdqa.github.io/clinicalevents.specialties/" class="external-link">Clinical
Events &amp; Specialties</a> module, toggling this parameter would mean
the difference between seeing that patients in your cohort are primarily
seen by Cardiologists and identifying that this trend is driven by an
uptick in Cardiologist visits starting in 2017.</p>
<p>Two modules, <a href="https://ssdqa.github.io/cohortattrition/" class="external-link">Cohort Attrition</a> and
<a href="https://ssdqa.github.io/sensitivityselectioncriteria/" class="external-link">Sensitivity
to Selection Criteria</a>, do not have longitudinal analyses available
since they are focused on the cohort and its characteristics rather than
the behavior of data across the cohort period.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hanieh Razzaghi, Kaleigh Wieand, Kimberley Dickinson, Charles Bailey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
