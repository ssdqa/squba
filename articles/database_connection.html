<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Connecting to Your Data â€¢ squba</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Connecting to Your Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">squba</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-modules" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Modules</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-modules">
<li><h6 class="dropdown-header" data-toc-skip>Cohort Identification</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/cohortattrition">  Cohort Attrition</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/sensitivityselectioncriteria">  Sensitivity to Selection Criteria</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cohort Fitness</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/patientfacts">  Patient Facts</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/patienteventsequencing">  Patient Event Sequencing</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/patientrecordconsistency">  Patient Record Consistency</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Variable Testing</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/expectedvariablespresent">  Expected Variables Present</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/quantvariabledistribution">  Quantitative Variable Distribution</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/categoricalvariabledistribution">  Categorical Variable Distribution</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Concept Set Testing</h6></li>
    <li><a class="external-link dropdown-item" href="https://ssdqa.github.io/conceptsetdistribution/">  Concept Set Distribution</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/sourceconceptvocabularies">  Source &amp; Concept Vocabularies</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Dataset Fitness</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ssdqa/clinicalevents.specialties">  Clinical Events &amp; Specialties</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/database_connection.html">Database Connection</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://hdl.handle.net/20.500.14642/2">PEDSpace</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ssdqa/squba/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Connecting to Your Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ssdqa/squba/blob/main/vignettes/database_connection.Rmd" class="external-link"><code>vignettes/database_connection.Rmd</code></a></small>
      <div class="d-none name"><code>database_connection.Rmd</code></div>
    </div>

    
    
<p>In order to use each of the packages in the SQUBA ecosystem, you must
first be able to connect to your CDM formatted data in the database
where it is stored. We have included a helper function that will allow
you to more easily set up this connection and provide the package with
the information it needs to execute the analyses.</p>
<div class="section level2">
<h2 id="initialize_dq_session">initialize_dq_session<a class="anchor" aria-label="anchor" href="#initialize_dq_session"></a>
</h2>
<p><code>initialize_dq_session</code> is the helper function included in
the <code>squba.gen</code> package and accessible through all other
SQUBA ecosystem packages. This function will intake user-specific
database connection information and use these to set up internal
configurations that will allow the data quality analyses to run.</p>
<p>We use a framework called <code>argos</code> to facilitate accessing
the data, so it is <strong>required</strong> to establish a connection
via this function. This ensures that all internal functions and
configurations are appropriately established without a need from the
user to directly interact with this framework. More information on
<code>argos</code> can be found <a href="https://github.com/PEDSnet/argos" class="external-link">here</a>.</p>
<p>A standard set up of <code>initialize_dq_session</code> may look
something like this:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ssdqa/conceptsetdistribution" class="external-link">conceptsetdistribution</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/squba.gen/man/initialize_dq_session.html" class="external-link">initialize_dq_session</a></span><span class="op">(</span>session_name <span class="op">=</span> <span class="st">'vignette_demo'</span>,</span>
<span>                      db_conn <span class="op">=</span> <span class="va">dbi_connection</span> <span class="op">/</span> <span class="st">'path/to/json/config'</span>, <span class="co">#choose one</span></span>
<span>                      is_json <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">/</span> <span class="cn">TRUE</span>, <span class="co">#choose one</span></span>
<span>                      working_directory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      file_subdirectory <span class="op">=</span> <span class="st">'my_files'</span>,</span>
<span>                      cdm_schema <span class="op">=</span> <span class="st">'my_cdm_schema'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parameter-walkthrough">Parameter Walkthrough<a class="anchor" aria-label="anchor" href="#parameter-walkthrough"></a>
</h2>
<div class="section level3">
<h3 id="session_name">
<strong>session_name</strong><a class="anchor" aria-label="anchor" href="#session_name"></a>
</h3>
<p>This is an arbitrary string value used to give a name to your
session. It is used for internal organization, so that multiple sessions
can more easily be differentiated.</p>
</div>
<div class="section level3">
<h3 id="db_conn-is_json">
<strong>db_conn</strong> &amp; <strong>is_json</strong><a class="anchor" aria-label="anchor" href="#db_conn-is_json"></a>
</h3>
<p>These parameters are where the actual database connection information
is read into the function. There are two methods that can be used to
input the connection details.</p>
<div class="section level4">
<h4 id="option-1-dbi-or-similar">Option 1: DBI (or similar)<a class="anchor" aria-label="anchor" href="#option-1-dbi-or-similar"></a>
</h4>
<p>One option is to create a connection object inside your R session
using <code>DBI</code> or a similar database connection package.
Instructions for how to use <code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">DBI::dbConnect</a></code> to establish a
connection can be found in <a href="https://dbi.r-dbi.org/articles/DBI.html" class="external-link">the DBI package
documentation</a>.</p>
<p>If this option is used, <code>is_json</code> should be set to
<strong>FALSE</strong>.</p>
</div>
<div class="section level4">
<h4 id="option-2-external-json-configuration">Option 2: External JSON Configuration<a class="anchor" aria-label="anchor" href="#option-2-external-json-configuration"></a>
</h4>
<p>Another option is to store your configuration details in a local JSON
file and provide the helper function with a path to that file. We have
provided a simple example below. As with Option 1, the type of
information that would be included in the file differs for different
database backends.</p>
<pre><code>{
    "src_name" : "Postgres",
    "src_args" : {
            "host"     : "my.database.server",
            "port"     : 5432,
            "dbname"   : "project_db",
            "username" : "my_username",
            "password" : "my_password",
            "options"  : "-c search_path=my_cdm_schema"
     },
     "post_connect_sql" : [
         "set role project_staff;"
     ]
     
}
</code></pre>
<p>If this option is used <code>is_json</code> should be set to
<strong>TRUE</strong>.</p>
</div>
</div>
<div class="section level3">
<h3 id="working_directory-file_subdirectory">
<strong>working_directory</strong> &amp;
<strong>file_subdirectory</strong><a class="anchor" aria-label="anchor" href="#working_directory-file_subdirectory"></a>
</h3>
<p>These parameters provide information about your local directory so
the analyses know where local files such as concept sets or input
configuration files can be accessed. When using a project-oriented
workflow in R, <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code> will default to the directory of
your project. Otherwise, you will need to point to the directory of
interest.</p>
<p><code>file_subdirectory</code> should be a directory nested inside of
the provided <code>working_directory</code> where local files are
stored. This ensures that all concept sets are accessible to the code
without the user having to explicitly define file paths multiple times
throughout the analysis process.</p>
</div>
<div class="section level3">
<h3 id="cdm_schema">
<strong>cdm_schema</strong><a class="anchor" aria-label="anchor" href="#cdm_schema"></a>
</h3>
<p>This should be the name of the schema (or database, depending on your
local setup) where the data in the appropriate CDM format (either OMOP
or PCORnet) is stored. Any supplemental tables that you may want to
access for the analyses should also be stored here</p>
</div>
<div class="section level3">
<h3 id="optional-parameters">Optional Parameters<a class="anchor" aria-label="anchor" href="#optional-parameters"></a>
</h3>
<p>This function has some additional parameters that can optionally be
specified should you so choose.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">initialize_dq_session</span>(<span class="at">session_name =</span> <span class="st">'vignette_demo'</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                      <span class="at">db_conn =</span> dbi_connection <span class="sc">/</span> <span class="st">'path/to/json/config'</span>, <span class="co">#choose one</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                      <span class="at">is_json =</span> <span class="cn">FALSE</span> <span class="sc">/</span> <span class="cn">TRUE</span>, <span class="co">#choose one</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>                      <span class="at">working_directory =</span> <span class="fu">getwd</span>(),</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>                      <span class="at">file_subdirectory =</span> <span class="st">'my_files'</span>,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>                      <span class="at">cdm_schema =</span> <span class="st">'my_cdm_schema'</span>,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>                      <span class="at">results_schema =</span> <span class="st">'my_results_schema'</span>, <span class="sc">**</span><span class="er">*</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>                      <span class="at">results_tag =</span> <span class="st">'_project_id'</span>, <span class="sc">**</span><span class="er">*</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>                      <span class="at">vocabulary_schema =</span> <span class="st">'vocabulary'</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>                      )</span></code></pre></div>
<div class="section level4">
<h4 id="results_schema">
<strong>results_schema</strong><a class="anchor" aria-label="anchor" href="#results_schema"></a>
</h4>
<p>If you would like to output any of your analysis results back to the
database, this string will define the destination schema. The
<code>output_tbl</code> function included as part of the
<code>argos</code> framework can be used to achieve this.</p>
</div>
<div class="section level4">
<h4 id="results_tag">
<strong>results_tag</strong><a class="anchor" aria-label="anchor" href="#results_tag"></a>
</h4>
<p>This is an optional string that would be appended on to any tables
output back to the database in the defined <code>results_schema</code>.
This is intended to assist with uniquely identifying tables for each
project/analysis and avoid accidental overwrites.</p>
</div>
<div class="section level4">
<h4 id="vocabulary_schema">
<strong>vocabulary_schema</strong><a class="anchor" aria-label="anchor" href="#vocabulary_schema"></a>
</h4>
<p>If you have the OMOP vocabulary tables available on your database and
would like to access them as part of the analysis, this is where you
would define the schema in which those tables are stored.</p>
<p>This parameter will primarily be used for OMOP database backends, but
can be used for PCORnet backends if the same or similar tables are
available.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hanieh Razzaghi, Kaleigh Wieand, Kimberley Dickinson, Charles Bailey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
